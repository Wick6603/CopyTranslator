name: Electron Build and Release

on:
  # å½“ä»£ç æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘
  push:
    branches:
      - main
  # ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  build:
    # ä½¿ç”¨æœ€æ–°çš„ Ubuntu è¿è¡Œå™¨
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Checkout code
        # æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Setup Node.js
        # è®¾ç½® Node.js ç¯å¢ƒï¼Œç‰ˆæœ¬å·è¯·æ ¹æ®é¡¹ç›®éœ€è¦è°ƒæ•´
        uses: actions/setup-node@v4
        with:
          node-version: '16' # Electron 8.x.x å»ºè®®ä½¿ç”¨ Node.js 12/14/16/18 LTSï¼Œè¿™é‡Œé€‰ç”¨ 16

      - name: ğŸ“¥ Install dependencies
        # å®‰è£…é¡¹ç›®ä¾èµ–
        run: npm install --loglevel verbose

      - name: ğŸ”¨ Run Electron Build
        # æ‰§è¡Œ package.json ä¸­çš„æ„å»ºå‘½ä»¤
        # æ­¤å‘½ä»¤å°†ç¼–è¯‘ Vue åº”ç”¨ï¼Œå¹¶ä½¿ç”¨ electron-builder æ‰“åŒ…æˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚
        # é»˜è®¤æƒ…å†µä¸‹ï¼Œelectron-builder ä¼šå°†è¾“å‡ºæ”¾åœ¨ dist_electron æ–‡ä»¶å¤¹ã€‚
        # ğŸš¨ æ³¨æ„ï¼šå¦‚æœæ‚¨çš„ç›®æ ‡å¹³å°æ˜¯ Windows æˆ– macOSï¼Œæœ€å¥½åœ¨å¯¹åº”çš„ Runner ä¸Šæ„å»ºï¼Œ
        # ä½†å¯¹äº Linux æ„å»ºï¼Œæˆ–ä¸ºäº†ç”Ÿæˆè·¨å¹³å°çš„å®‰è£…åŒ…ï¼ˆå¦‚æœé…ç½®æ­£ç¡®ï¼‰ï¼Œè¿™ä¸ªæ­¥éª¤é€šå¸¸å¯ä»¥è¿è¡Œã€‚
        run: npm run electron:build

      - name: ğŸ“¦ Archive Build Artifacts
        # å°†ç”Ÿæˆçš„æ„å»ºç›®å½•æ‰“åŒ…ä¸ºå¯ä¸‹è½½çš„ Artifact
        uses: actions/upload-artifact@v4
        with:
          # æ‰“åŒ…æ–‡ä»¶å¤¹çš„åç§°ï¼Œé€šå¸¸æ˜¯ electron-builder çš„é»˜è®¤è¾“å‡ºç›®å½•
          name: electron-build-output
          # æ–‡ä»¶å¤¹è·¯å¾„ã€‚æ ¹æ®æ‚¨çš„ electron-builder é…ç½®ï¼Œå¯èƒ½æ˜¯ dist æˆ– dist_electron
          path: dist_electron
          # å¯é€‰ï¼šè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå¤©ï¼‰
          retention-days: 7

      - name: âœ… Build finished
        run: echo "Electron build artifacts are ready for download!"
